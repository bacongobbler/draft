+++
dep = 7
title = "Draft Init Drivers"
authors = [ "Matt Fisher <matt.fisher@microsoft.com>" ]
created = 2017-02-28
+++

# Introduction

Draft Init Drivers are a special type of [plugin][]. They initialize Draftd on a given cloud provider utilizing their best-of-breed technology, released on a separate schedule than Draft's core.

# Abstract

Draft Init Drivers are plugins that integrate seamlessly with Draft. They provide a way to install the Draft server on a given cloud provider without requiring every cloud provider to contribute to the core tool.

New drivers are installed using the `draft plugin install` command. For example,

```bash
$ draft plugin install https://github.com/bacongobbler/draft-init-minikube
```

Will install the `minikube` driver.

To run `draft init` with a driver, provide the name of the driver with the `--driver` flag. With the previous example, this can be called by running

```bash
$ draft init --driver=minikube
```

By not providing the `--driver` flag, `draft init` will use the existing behaviour, so these drivers are purely opt-in. Should drivers prove to be the best way forward for `draft init`, this may eventually become the default at a later time.

## Writing a Driver

When Draft invokes an init driver, it will first package the chart, merging values provided through the CLI option flags like `--ingress-enabled=true` into the chart's `values.yaml`. After packaging the chart, draft invokes the plugin and provides the local path to the packaged chart as the plugin's first argument. It is the responsibility of the plugin to install the chart into the cluster.

Writing a new driver for Draft is the same as writing a new plugin, with a few caveats:

1. The name of the plugin must be `draft-init-drivername`
1. The plugin accepts a single argument: the local path to the chart containing `draftd`
1. `draft` will pass configuration to the plugin through environment variables
1. The name of the Helm release installed in the cluster *should* be identifiable, such as `draft`. This allows the driver to re-use that same name when `draft init --upgrade` is called.

As well as the regular environment variables passed in to plugins, the drivers are passed in a few extra environment variables as requested by the user. Those are

- `DRAFT_INIT_DRAFT_NAMESPACE`: the namespace requested where `draftd` should be installed to (via `draft init --draft-namespace`)
- `DRAFT_INIT_DRIVER_NAME`: the name of the driver, as determined by `draft init --driver=mydrivername`
- `DRAFT_INIT_INGRESS_ENABLED`: when present, the user is requesting that draftd be installed along with an ingress controller, if one isn't already present
- `DRAFT_INIT_UPGRADE`: when present, the user has called `draft init --upgrade`, meaning that they are requesting to upgrade the existing Draftd instance with this new chart.

NOTE: the chart passed to the driver as the first argument will have the correct information to enable ingress from Draft's end. These environment variables are just there for the cloud provider's use as a "head's up!".

# Motivation

There are several existing issues with the current `draft init` experience, from the maintenance side:

- maintainers may not have an expansive knowledge base on every cloud provider feature set, making pull requests harder to approve and accept
- vendors want to provide the best experience for developing applications on their cloud
- vendors may want to release their provider support on a schedule separate from Draft's release schedule (e.g. a new authentication method is released and they need to re-write their driver)

Each cloud provider has their own unique set of tooling, all of which require different setups for Draft to work on their system. Additionally, the core maintainers want to make the install procedure up to the cloud providers, allowing them to focus on Draft's core experience.


[plugin]: dep-005.md
